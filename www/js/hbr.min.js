((function(){_.mixin(_.string.exports()),Ext.setup({onReady:function(){return new HBR.Main}}),Ext.regModel("Game",{fields:["id","type","count"],proxy:{id:"hbrgame",type:"localstorage"}}),Ext.ns("HBR"),HBR.Players=Ext.extend(Ext.Panel,{constructor:function(a){var b,c,d;a==null&&(a={}),c=[],Ext.applyIf(a,{items:c,layout:"hbox"});for(b=1,d=Math.ceil(2+3*Math.random());1<=d?b<=d:b>=d;1<=d?b++:b--)c.push(new Ext.Panel({flex:1,html:"Player "+b+"<br>0 coins"}));return HBR.Players.superclass.constructor.call(this,a)}}),Ext.ns("HBR"),HBR.Roller=Ext.extend(Ext.Panel,{constructor:function(a){a==null&&(a={}),Ext.applyIf(a,{cls:"roller",dockedItems:[{dock:"top",items:[{flex:1,html:"buts"},{flex:1,html:"words"},{flex:1,html:"ands"}],layout:"hbox"},{dock:"bottom",items:new Ext.Button({text:"Done",ui:"confirm"})}],items:[{items:[{xtype:"spacer"},{handler:function(){return this.roll(1)},scope:this,text:"1",ui:"round"},{handler:function(){return this.roll(2)},scope:this,text:"2",ui:"round"},{handler:function(){return this.roll(3)},scope:this,text:"3",ui:"round"},{xtype:"spacer"}],layout:{pack:"center"},ui:"light",xtype:"toolbar"}],store:Ext.StoreMgr.get("game"),title:"Roll"}),HBR.Roller.superclass.constructor.call(this,a),this.on("render",function(){return this.el.on("singletap",function(a){var b;b=Ext.fly(a.target);if(b.is("li"))return this.roll(b.getAttribute("data-count"))},this)},this)},rollDie:function(){var a;return a=Math.random(),a<1/3?this.addDie("but"):1/3<a&&a<2/3?this.addDie("word"):this.addDie("and")},addDie:function(a){var b;b=this.up(".main").store.get("type",a);debugger},getWordCountStore:function(){},roll:function(a){var b,c,d;d=[];for(b=1,c=Number(a);1<=c?b<=c:b>=c;1<=c?b++:b--)d.push(this.rollDie());return d}}),Ext.ns("HBR"),HBR.WordCount=Ext.extend(Ext.Panel,{constructor:function(a){return a==null&&(a={}),Ext.applyIf(a,{cls:"word-count",count:0,items:new HBR.FreeWord(a.type)}),HBR.WordCount.superclass.constructor.call(this,a)},addWord:function(){return this.setCount(++this.count),this.add(new HBR.BlankWord),this.doLayout()},setCount:function(a){this.count=a;if(this.type!=="Robot"&&this.count>=4)return this.fireEvent("wordoverflow")}}),Ext.ns("HBR"),HBR.Sentence=Ext.extend(Ext.Panel,{constructor:function(a){return a==null&&(a={}),a=Ext.applyIf(a,{active:!1,cls:"sentence",flex:1,html:"Active sentence",layout:"auto"}),HBR.Sentence.superclass.constructor.call(this,a)},activate:function(){return this.active=!0},deactivate:function(){return this.active=!1},getEmptyWord:function(){return _.find(this.query(".editable-word"),function(a){return _(a.getValue()).trim()===""})},focusEmptyWord:function(){var a;return(a=this.getEmptyWord())!=null?a.focus():void 0},hasEmptyWord:function(){return!!this.getEmptyWord()}}),Ext.reg("sentence",HBR.Sentence),Ext.ns("HBR"),HBR.Story=Ext.extend(Ext.Panel,{constructor:function(a){var b;return a==null&&(a={}),b=[],Ext.applyIf(a,{items:b,layout:{align:"stretch",type:"vbox"}}),b.push(new HBR.Sentence({html:"Happy Birthday, Robot!"}),new HBR.Sentence({active:!0})),HBR.Story.superclass.constructor.call(this,a)},addBlankWord:function(a){var b;return b=_.last(this.query(".sentence")),b.hasEmptyWord()?b.focusEmptyWord():(b.add(new HBR.EditableWord),b.doLayout(),b.focusEmptyWord(),a.destroy())}}),Ext.reg("story",HBR.Story),Ext.ns("HBR"),HBR.Word=Ext.extend(Ext.Panel,{constructor:function(a){return a==null&&(a={}),HBR.Word.superclass.constructor.call(this,a)},getStory:function(){return Ext.ComponentQuery.query("story")[0]}}),Ext.ns("HBR"),HBR.BlankWord=Ext.extend(HBR.Word,{constructor:function(){return HBR.BlankWord.superclass.constructor.call(this,{cls:"blank-word",listeners:{render:function(){return this.el.on("singletap",function(){return this.getStory().addBlankWord(this)},this)},scope:this},html:"Word"})}}),Ext.ns("HBR"),HBR.EditableWord=Ext.extend(Ext.form.Text,{constructor:function(){return HBR.EditableWord.superclass.constructor.call(this,{cls:"editable-word",width:220})}}),Ext.reg("editable-word",HBR.EditableWord),Ext.ns("HBR"),HBR.FreeWord=Ext.extend(HBR.Word,{constructor:function(a){return HBR.FreeWord.superclass.constructor.call(this,{cls:"free-word",listeners:{render:function(){return this.el.on("singletap",function(a){return this.getStory().addFreeWord("Robot")},this)},scope:this},html:a})}}),Ext.ns("HBR"),HBR.Main=Ext.extend(Ext.Panel,{constructor:function(a){return a==null&&(a={}),this.andCount=new HBR.WordCount({dock:"right",layout:"vbox",listeners:{wordoverflow:function(){return this.roller.disable()},scope:this},type:"but"}),this.butCount=new HBR.WordCount({dock:"left",layout:"vbox",listeners:{wordoverflow:function(){return this.roller.disable()},scope:this},type:"and"}),this.wordCount=new HBR.WordCount({dock:"bottom",layout:"hbox",type:"Robot"}),this.roller=new HBR.Roller({listeners:{diceroll:function(a){return a==="but"?this.butCount.addWord():a==="and"?this.andCount.addWord():this.wordCount.addWord()},scope:this}}),this.store=new Ext.data.Store({id:"game",model:"Game"}),this.players=new HBR.Players({dock:"top"}),this.story=new HBR.Story,Ext.applyIf(a,{fullscreen:!0,items:this.roller,layout:"card"}),HBR.Main.superclass.constructor.call(this,a)}}),Ext.reg("main",HBR.Main)})).call(this);